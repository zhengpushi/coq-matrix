# 不同矩阵模型的OCaml程序抽取及测试

## 1. 测试方法

* 测试的内容

  * 矩阵乘法的正确性，执行效率
  * 其他内容待补充

* 测试的步骤

  * 随机生成 float list list 数据；

  * 调用 l2m 转换为内部的矩阵模型
  * 调用 mmul 作矩阵乘法;
  * 再调用 m2l 转换为 float list list
  * 打印

* 测试程序用法

  ```
  $ ./matrix --help
  Usage: ./test [option] where options are:
    -mm Set matrix model (DL/DP/DR/NF/FF)
    -size Set matrix dimension
    -print Show matrix content
    -benchmark Benchmark mode, automatic test
    -help  Display this list of options
    --help  Display this list of options
  ```
  
  这里提供了几个可选参数，
  
  * mm 指定矩阵模型，可使用 DL/DP/DR/NF/FF 这五种模型
  * size 指定矩阵维度，为简单起见，作矩阵乘法的两个矩阵的三个维度都用同一个值。即：$A(r\times c) \times B(c\times s) = C (r\times s)$，其中的 r = c = s = size。
  * print 是否打印矩阵，只会打印少量的头部信息，不会全部打印。
  * benchmark 是否执行基准测试，自动选择模型，自动增加矩阵规模，从而无限循环的测试性能。


## 2. 测试结果

* 版本 ( Nov 04, 2022)

  * 结论：所有矩阵模型均能够进行代码抽取和矩阵运算，但效率差异较大

  * 正确性：NF模型是错误的，其余四个正确

    * 使用相同的输入（固定了随机数的种子，生成的输入矩阵相同），前四个模型下，矩阵乘法结果相同。
    * NF模型，由于 choiceType 的构造尚未实现，因此尚未取出内容，所以结果错误。

  * 效率差异比较

    以不同的矩阵维度做乘法，统计执行时间（单位：秒）。

    FF模型结果错误，而且太慢，不参与比较。简要的结果是：

    size=10, 0.14s

    size=20, 3.50s

    size =25, 12s

    size=30, 40s

    其余四种模型的比较

    | size\model | DL    | DP   | DR   | NF     | FF   |
    | ---------- | ----- | ---- | ---- | ------ | ---- |
    | 20         | 0.00  | 0.00 | 0.00 | 0.00   | 3.50 |
    | 50         | 0.26  | 0.02 | 0.01 | 0.37   |      |
    | 60         | 0.52  | 0.04 | 0.02 | 0.76   |      |
    | 72         | 1.04  | 0.06 | 0.02 | 1.58   |      |
    | 86         | 2.06  | 0.10 | 0.04 | 3.22   |      |
    | 103        | 4.18  | 0.18 | 0.07 | 6.52   |      |
    | 123        | 8.42  | 0.30 | 0.12 | 13.11  |      |
    | 147        | 17.26 | 0.51 | 0.19 | 26.63  |      |
    | 176        | 34.46 | 0.86 | 0.33 | 54.43  |      |
    | 211        | 72.90 | 1.48 | 0.55 | 111.90 |      |
    | 253        |       |      |      |        |      |

    结果分析

    * 由于这个测试方案是以list为中间结果，因此与实现模型相关。
    * 所有函数未经过优化，包括尾递归分析等都没有做。

  * 
